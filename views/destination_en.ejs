<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destination - BALIMATE</title>

    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <link href="https://storage.googleapis.com/gambara/balimate%20logo.png" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="../../../style/style.css" rel="stylesheet">
</head>

<body>

    <!-- Topbar Start -->
    <div class="container-fluid bg-light pt-3 d-none d-lg-block">
        <a class="mt-3" href="/">
            <h1 class="text-warning"><span class="text-dark">BALI</span>MATE</h1>
        </a>
    </div>


    <!-- Carousel Start -->
    <div class="container-fluid p-0 m-0">
        <div id="carousel-container" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div id="photos-container"></div>
                <a class="carousel-control-prev" href="#carousel-container" data-slide="prev">
                    <div class="btn btn-dark" style="width: 45px; height: 45px;">
                        <span class="carousel-control-prev-icon mb-n2"></span>
                    </div>
                </a>
                <a class="carousel-control-next" href="#carousel-container" data-slide="next">
                    <div class="btn btn-dark" style="width: 45px; height: 45px;">
                        <span class="carousel-control-next-icon mb-n2"></span>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <!-- Carousel End -->


    <!-- Carousel Start -->
    <div class="container-fluid text-white" style="margin-top: -9rem; position: relative; z-index: 1;">
        <div class="row justify-content-center">
            <div class="col-md-8 d-flex flex-column" style="gap: 0.3rem">
                <div class="row">
                    <h2 id="place-name" style="color: whitesmoke"></h2>
                </div>
                <div class="row d-flex" style="gap: 1rem">
                    <div id="stars" style="width: fit-content; font-size: 1.2rem;"></div>
                    <div id="place-rating"></div>
                </div>
            </div>
            <div class="col-md-2 d-flex justify-content-end align-items-center" style="padding-right: 6%">
                <i id="like" class="far fa-heart" onclick="toggleLike()" style="font-size: 2.5rem; cursor: pointer"></i>
            </div>
        </div>
    </div>
    <!-- Carousel End -->


    <!-- Information Start -->
    <div class="container-fluid booking mt-5 pb-5" style="margin-top: 1.5rem !important">
        <div class="container pb-5">
            <div class="bg-light shadow" style="padding: 30px;">
                <div class="row align-items-center pl-5 pr-5" style="min-height: 60px;">
                    <div class="col-md-6">
                        <div class="row">
                            <h4><span id="price"></span></h4>
                        </div>
                        <div class="row" style="font-size: 1rem;">
                            (weekday - weekend)
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row justify-content-end align-items-center" style="flex-wrap: nowrap; gap: 3rem">
                            <a id="maps-link" target="_blank">
                                <img src="../../../img/map-icon.png" style="width: auto; height: 2.5rem;">
                            </a>
                            <div class="d-flex align-items-center" style="width: fit-content; gap: 0.83rem">
                                <img id="weather-icon" style="width: auto; height: 3.3rem;">
                                <div id="temp" style="height: fit-content; font-size: 1.1rem;font-weight: 600;">21 Â°C
                                </div>
                            </div>
                            <a id="more-info-link" target="_blank">
                                <button type="button" id="more-info-btn" class="btn btn-warning shadow p-3 text-white"
                                    style="width: fit-content; font-size: 0.83rem; border-radius: 0.83rem">
                                    MORE INFORMATION
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Information End -->


    <!-- Description Start -->
    <div class="container-fluid">
        <div class="row justify-content-center align-items-center d-flex" style="font-size: 0.9rem; gap: 8rem;">
            <div class="col-md-4 d-flex flex-column" style="gap: 2.5rem">
                <h5>Description</h5>
                <p id="description"></p>
                <a href="../review/<%= placeid %>" id="review-link">
                    <button type="button" id="review-btn" class="btn btn-dark rounded text-white"
                        style="width: fit-content; padding: 0.5rem 2.5rem; font-size: 0.83rem;">
                        Write a review
                    </button>
                </a>
            </div>
            <div class="col-md-4 align-items-center" style="width: 360px; height: 240px; overflow: hidden;">
                <img id="thumbnail" style="height: 100%">
            </div>
        </div>
    </div>
    <!-- Description End -->


    <!-- More Like This Start -->
    <div class="container" style="margin-top: 9rem">
        <div class="row d-flex justify-content-center" style="gap: 3.5rem">
            <div class="col-md-11">
                <h4>More like this</h4>
            </div>
            <div id="more-like" class="row d-flex flex-wrap justify-content-center"></div>
        </div>
    </div>
    <!-- More Like This End -->


    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-white-50 py-5 px-sm-3 px-lg-5" style="margin-top: 90px;">
        <div class="row pt-5">
            <div class="col-lg-3 col-md-6 mb-5">
                <a href="" class="navbar-brand">
                    <h1 class="text-warning"><span class="text-white">BALI</span>MATE</h1>
                </a>
                <p>Just tell us where you are going on vacation in Bali, we will provide the best recommendations.
                </p>
            </div>
            <div class="col-lg-3 col-md-6 mb-5">
                <h5 class="text-white text-uppercase mb-4" style="letter-spacing: 5px;">Our Services</h5>
                <div class="d-flex flex-column justify-content-start">
                    <a class="text-white-50 mb-2" href="/"><i class="fa fa-angle-right mr-2"></i>Home</a>
                    <a class="text-white-50 mb-2" href="/#top-destinations"><i class="fa fa-angle-right mr-2"></i>Top
                        Destinations</a>
                    <a class="text-white-50 mb-2" href="/#recommendations"><i
                            class="fa fa-angle-right mr-2"></i>Recommendations</a>
                    <a class="text-white-50 mb-2" href="../favorites"><i
                            class="fa fa-angle-right mr-2"></i>Favorites</a>
                    <a class="text-white-50 mb-2" href="/#contact"><i class="fa fa-angle-right mr-2"></i>Contact</a>
                </div>
            </div>
            <div class="col-lg-2 col-md-6 mb-5">
            </div>
            <div class="col-lg-4 col-md-6 mb-5">
                <h5 class="text-white text-uppercase mb-4" style="letter-spacing: 5px;">Contact Us</h5>
                <p><i class="fa fa-map-marker-alt mr-2"></i>Bali, Indonesia</p>
                <p><i class="fa fa-envelope mr-2"></i>balimate-support@bangkit.academy</p>
            </div>
        </div>
    </div>
    <div class="container-fluid bg-dark text-white border-top py-4 px-sm-3 px-md-5"
        style="border-color: rgba(256, 256, 256, .1) !important;">
        <div class="row">
            <div class="col-lg-6 text-center text-md-right">
                <p class="m-0 text-white-50">BALIMATE 2023
                </p>
            </div>
        </div>
    </div>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-warning btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>



    <!-- Get Destination Data -->
    <script>
        const path = window.location.pathname
        const parts = path.split('/')
        const userid = parts[2]
        const placeid = parts[4]

        fetch(`https://api-dot-balimate-dev.et.r.appspot.com/destinations/${placeid}?lang=en`)
            .then(function (response) {
                return response.json();
            })
            .then(function (resp) {
                if (resp.code === 'success') {
                    var placeName = document.getElementById('place-name');
                    placeName.textContent = resp.data.place_name;

                    var description = document.getElementById('description');
                    description.textContent = resp.data.description;

                    // Price
                    var priceContainer = document.getElementById('price');
                    if (resp.data.weekend_holiday_price === 0 && resp.data.weekday_price === 0) {
                        priceContainer.innerText = 'Free'
                    } else if (resp.data.weekend_holiday_price === resp.data.weekday_price) {
                        var weekdayPr = new Intl.NumberFormat('en-US').format(resp.data.weekday_price);
                        priceContainer.innerText = '$ ' + weekdayPr
                    } else {
                        var weekdayPr = new Intl.NumberFormat('en-US').format(resp.data.weekday_price);
                        var weekendPr = new Intl.NumberFormat('en-US').format(resp.data.weekend_holiday_price);
                        priceContainer.innerText = '$ ' + weekdayPr + ' - ' + weekendPr
                    }

                    // Rating
                    var rating = document.getElementById('place-rating');
                    rating.textContent = resp.data.rating;

                    var stars = document.getElementById('stars')
                    var iterate = (resp.data.rating * 2) - 1;
                    for (var i = 0; i < 10; i++) {
                        if (i % 2 !== 0 && i <= iterate) {
                            var fullStar = document.createElement('i')
                            fullStar.className = 'fas fa-star'
                            fullStar.style.color = 'gold'
                            stars.append(fullStar)
                        }
                        else if (i % 2 !== 0 && i > iterate && (i - 1) <= iterate) {
                            var halfStar = document.createElement('i')
                            halfStar.className = 'fas fa-star-half-alt'
                            halfStar.style.color = 'gold'
                            stars.append(halfStar)
                        }
                        else if (i % 2 === 0 && i > iterate) {
                            var blankStar = document.createElement('i')
                            blankStar.className = 'far fa-star'
                            stars.append(blankStar)
                        }
                    }

                    // Maps
                    var mapsLink = document.getElementById('maps-link');
                    mapsLink.href = resp.data.maps_url;

                    // More Info
                    var moreInfoLink = document.getElementById('more-info-link');
                    var moreInfoBtn = document.getElementById('more-info-btn')
                    if (resp.data.more_information === '') {
                        moreInfoLink.classList.add('disabled-link')
                        moreInfoBtn.classList.add('disabled')
                    } else {
                        moreInfoLink.href = resp.data.more_information;
                    }

                    // Weather
                    var temp = document.getElementById('temp');
                    temp.innerText = resp.data.temp + ' Â°C';

                    var weather = document.getElementById('weather-icon');
                    switch (resp.data.weather) {
                        case 'Clear': weather.src = '../../../img/clear.png'; break;
                        case 'Clouds': weather.src = '../../../img/clouds.png'; break;
                        case 'Thunderstorm': weather.src = '../../../img/clouds.png'; break;
                        case 'Rain': weather.src = '../../../img/rain.png'; break;
                        case 'Drizzle': weather.src = '../../../img/shower.png'; break;
                        case 'Atmosphere': weather.src = '../../../img/atmosphere.png'; break;
                    }


                    // Photos
                    var photosContainer = document.getElementById('photos-container');
                    var photos = resp.data.photos;

                    for (var i = 0; i < photos.length; i++) {
                        var slide = document.createElement('div');
                        if (i === 0) {
                            slide.className = 'carousel-item active';
                        } else {
                            slide.className = 'carousel-item'
                        }
                        slide.style.height = '35rem';
                        var slideTemplate = `
                                    <img class="w-100 object-fit-cover overflow-hidden photo" src="${photos[i]}">
                                    <div class="carousel-caption" style="background: rgba(0,0,0,0.3)"></div>`
                        slide.innerHTML = slideTemplate
                        photosContainer.appendChild(slide);
                    }

                    var thumbnail = document.getElementById('thumbnail');
                    thumbnail.src = photos[photos.length - 1]
                } else {
                    console.log(resp)
                }
            })
            .catch(function (error) {
                console.log(error)
            });
    </script>


    <!-- Get has Like -->
    <script>
        const likeButton = document.getElementById('like');

        fetch(`https://api-dot-balimate-dev.et.r.appspot.com/users/${userid}/favorites/check?placeid=${placeid}`)
            .then(function (response) {
                return response.json()
            })
            .then(function (resp) {
                if (resp.code === 'success') {

                    if (resp.data.hasLiked === 1) {
                        likeButton.className = 'fas fa-heart'
                        likeButton.style.color = 'red'
                    }

                } else {
                    console.log(resp)
                }
            })

        function toggleLike() {
            const likeButton = document.getElementById('like');
            const xhttpr = new XMLHttpRequest();

            if (likeButton.className === 'far fa-heart') {
                likeButton.style.color = 'red';
                likeButton.className = 'fas fa-heart';

                xhttpr.open("POST", `https://api-dot-balimate-dev.et.r.appspot.com/users/${userid}/favorites?placeid=${placeid}`)
                xhttpr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttpr.send();
            }
            else if (likeButton.className === 'fas fa-heart') {
                likeButton.style.color = 'white';
                likeButton.className = 'far fa-heart';

                xhttpr.open("DELETE", `https://api-dot-balimate-dev.et.r.appspot.com/users/${userid}/favorites?placeid=${placeid}`)
                xhttpr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttpr.send();
            }
        }
    </script>


    <!-- Get has Review -->
    <script>
        const reviewLink = document.getElementById('review-link');
        const reviewButton = document.getElementById('review-btn');

        fetch(`https://api-dot-balimate-dev.et.r.appspot.com/users/${userid}/reviews/check?placeid=${placeid}`)
            .then(function (response) {
                return response.json()
            })
            .then(function (resp) {
                if (resp.code === 'success') {

                    if (resp.data.hasLiked === 1) {
                        reviewLink.classList.add('disabled-link')
                        reviewButton.classList.add('disabled')
                    }

                } else {
                    console.log(resp)
                }
            })
    </script>


    <!-- More Like -->
    <script>
        const morelike = document.getElementById('more-like')

        fetch(`http://localhost:4000/predict?userid=${userid}`)
            .then(function (response) {
                return response.json()
            })
            .then(function (resp) {
                if (resp.code == 'success') {
                    for (const key in resp.data) {
                        if (Number(key) == 6) {
                            break;
                        }
                        const thumbnail = resp.data[key].thumbnail_url;
                        const place_id = resp.data[key].place_id;
                        const placeName = resp.data[key].place_name;
                        const description = resp.data[key].description;
                        const weekendPrice = new Intl.NumberFormat('id').format(resp.data[key].weekend_holiday_price);
                        const weekdayPrice = new Intl.NumberFormat('id').format(resp.data[key].weekday_price);
                        const category = resp.data[key].category;
                        const city = resp.data[key].city;
                        const rating = resp.data[key].rating;

                        var price
                        if (weekdayPrice == 0)
                            price = 'Free'
                        else
                            price = 'Rp. ' + weekdayPrice

                        const placeContainer = document.createElement('div')
                        placeContainer.className = 'col-4 d-flex justify-content-center'
                        const template = `
                        <div class="card" style="width: 24rem; cursor: auto">
                            <div class="d-flex justify-content-center overflow-hidden">
                                <img src="${thumbnail}" class="card-img-top" alt="${placeName}" style="height: 14.5rem; width: auto">
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <p><i class="fa fa-map-marker-alt"></i> ${city}</p>
                                    </div>
                                    <div class="col-6">
                                        <p class="float-end"><svg width="18" height="22" viewBox="0 0 18 22" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M1 11.7166H7C7.26522 11.7166 7.51957 11.5931 7.70711 11.3734C7.89464 11.1537 8 10.8557 8 10.5449V1.17166C8 0.860916 7.89464 0.5629 7.70711 0.343171C7.51957 0.123442 7.26522 0 7 0H1C0.734784 0 0.48043 0.123442 0.292893 0.343171C0.105357 0.5629 0 0.860916 0 1.17166V10.5449C0 10.8557 0.105357 11.1537 0.292893 11.3734C0.48043 11.5931 0.734784 11.7166 1 11.7166ZM0 19.9182C0 20.2289 0.105357 20.527 0.292893 20.7467C0.48043 20.9664 0.734784 21.0899 1 21.0899H7C7.26522 21.0899 7.51957 20.9664 7.70711 20.7467C7.89464 20.527 8 20.2289 8 19.9182V15.2316C8 14.9208 7.89464 14.6228 7.70711 14.4031C7.51957 14.1834 7.26522 14.0599 7 14.0599H1C0.734784 14.0599 0.48043 14.1834 0.292893 14.4031C0.105357 14.6228 0 14.9208 0 15.2316V19.9182ZM10 19.9182C10 20.2289 10.1054 20.527 10.2929 20.7467C10.4804 20.9664 10.7348 21.0899 11 21.0899H17C17.2652 21.0899 17.5196 20.9664 17.7071 20.7467C17.8946 20.527 18 20.2289 18 19.9182V11.7166C18 11.4058 17.8946 11.1078 17.7071 10.8881C17.5196 10.6684 17.2652 10.5449 17 10.5449H11C10.7348 10.5449 10.4804 10.6684 10.2929 10.8881C10.1054 11.1078 10 11.4058 10 11.7166V19.9182ZM11 8.20161H17C17.2652 8.20161 17.5196 8.07817 17.7071 7.85844C17.8946 7.63871 18 7.3407 18 7.02995V1.17166C18 0.860916 17.8946 0.5629 17.7071 0.343171C17.5196 0.123442 17.2652 0 17 0H11C10.7348 0 10.4804 0.123442 10.2929 0.343171C10.1054 0.5629 10 0.860916 10 1.17166V7.02995C10 7.3407 10.1054 7.63871 10.2929 7.85844C10.4804 8.07817 10.7348 8.20161 11 8.20161Z"
                                                    fill="#8A8A8A" />
                                            </svg>
                                            ${category}</p>
                                    </div>
                                </div>
                                <a href="/user/${userid}/destination/${place_id}">
                                  <h5 class="card-text fw-bold my-2">
                                      ${placeName}
                                  </h5>
                                </a>
                                <div class="pt-2">
                                  ${description.slice(0, 55) + '...'}
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-6">
                                        <span><i class="fas fa-star" style="color: gold;"></i> ${rating}</span>
                                    </div>
                                    <div class="col-6">
                                        <p class="float-end">${price}</p>
                                    </div>
                                </div>
    
                            </div>
                        </div>`

                        placeContainer.innerHTML = template
                        morelike.append(placeContainer)
                    }
                } else {
                    console.log(resp)
                }
            })
            .catch(function (error) {
                console.log(error);
            });
    </script>
</body>

</html>